<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Audio Recorder</title>
</head>
<body>

  <!-- Mic Button -->
  <button id="micButton">üé§</button>

  <script>
    const micButton = document.getElementById('micButton');
    let mediaRecorder;
    let audioChunks = [];

    // Start recording when mic button is clicked
    micButton.addEventListener('click', async () => {
      if (mediaRecorder && mediaRecorder.state === "recording") {
        // Stop the recording
        mediaRecorder.stop();
        micButton.textContent = 'üé§';  // Reset button
      } else {
        // Start the recording
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        mediaRecorder = new MediaRecorder(stream);
        audioChunks=[];
        // When data is available, push it to audioChunks
        mediaRecorder.ondataavailable = event => {
          audioChunks.push(event.data);
        };

        // When recording is stopped, send the audio file
        mediaRecorder.onstop = async () => {
          const audioBlob = new Blob(audioChunks, { type: 'audio/ogg' });
          const audioFile = new File([audioBlob], 'record.ogg', { type: 'audio/ogg' });

          // Send the file to the FastAPI backend
          const formData = new FormData();
          formData.append('file', audioFile);

          // Send a POST request to your FastAPI server
          const response = await fetch('http://localhost:8000/upload_audio', {
            method: 'POST',
            body: formData
          });
          if (response.ok) {
            console.log('Audio uploaded successfully!');
          } else {
            console.error('Error uploading audio');
          }
        };

        mediaRecorder.start();
        micButton.textContent = '‚èπÔ∏è';  // Change button to stop
      }
    });
  </script>

</body>
</html>
